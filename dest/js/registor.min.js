window.onload = function(){
	var oUname = document.getElementById("uname");
	var oPwd = document.getElementById("pwd");
	var oReg = document.getElementById("registor");
	var oLog = document.getElementById("login");
	var oSpanUn = document.getElementById("un");
	var oSpanPwd = document.getElementById("pass");
	var oText = document.getElementById("text");
	var oRe = document.getElementById("re");
	var arr = [false,false];
	oUname.onblur = function(){
		var uname = oUname.value;
		var re = /^[\u4e00-\u9fa5\w]{3,12}$/;
		if(!re.test(uname)){
			oSpanUn.innerHTML = '您的用户名不符合规则';
			oSpanUn.style.color = 'red';
			arr[0] = false;
		}else{
			oSpanUn.innerHTML = '中文、字母、数字、下划线的组合,3到12位';
			oSpanUn.style.color = 'greenyellow';
			arr[0] = true;
		}
	}
	oPwd.onblur = function(){
		var pwd = oPwd.value;
		var re = /^\w{6,12}$/;
		if(!re.test(pwd)){
			oSpanPwd.innerHTML = '您的密码不符合规则';
			oSpanPwd.style.color = 'red';
			arr[1] = false;
		}else{
			oSpanPwd.innerHTML = '字母、数字、下划线，6到12位';
			oSpanPwd.style.color = 'greenyellow';
			arr[1] = true;
		}
	}
	oReg.onclick = function(){
		var uname = oUname.value;
		var pwd = oPwd.value;
		console.log(uname,pwd);
		if(!uname){
			oText.innerHTML='用户名不能为空！';
			oText.style.color = "red";
			oText.style.fontSize = "12px";
			return;
		}
		if(arr.indexOf(false) != -1){
			oText.innerHTML='请正确填写信息！';
			oText.style.color = "red";
			oText.style.fontSize = "12px";
			return;
		}
// 		oRe.onclick = function(){
// 			oText.innerHTML='';
// 		}
		/*
			'user1:pwd1,user2:pwd2,user3:pwd3'
			{
				user1 : pwd1,
				user2 : pwd2,
				user3 : pwd3
			}
		*/
		var cookieStr = getCookie('registorUser') ? getCookie('registorUser') : '';
		var cookieObj = convertCookieStrToObj(cookieStr);
		if(uname in cookieObj){
			oText.innerHTML='用户名已存在！';
			oText.style.color = "red";
			oText.style.fontSize = "12px";
			return;
		}else{
			cookieObj[uname] = pwd;
			cookieStr = convertObjToCookieStr(cookieObj);
			createCookie('registorUser',cookieStr,7);
			oText.innerHTML='注册成功！';
			oText.style.color = "red";
			oText.style.fontSize = "12px";
		}
		alert(decodeURIComponent(document.cookie))
	}
	oLog.onclick = function(){
		location.href = '../html/login.html';
	}
	//将cookie字符串转为对象
	function convertCookieStrToObj(str){
		if(!str){
			return {};
		}
		
		var arr = str.split(','); //"a11:111111"
		console.log(arr);
		var obj = {};
		for(var i = 0;i < arr.length;i ++){
			var list = arr[i].split(':');
			obj[list[0]] = list[1];
		}
		return obj;
	}
	//将对象转为cookie字符串
	function convertObjToCookieStr(obj){
		var str = '';
		for(var i in obj){
			var pwd = obj[i];
			if(str){
				str += ',';
			}
			str += i + ':' + pwd;
		}
		return str;
	}
}